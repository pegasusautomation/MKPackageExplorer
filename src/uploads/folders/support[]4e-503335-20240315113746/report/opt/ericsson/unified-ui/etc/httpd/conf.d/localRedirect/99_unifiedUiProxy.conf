# Unified UI
  RewriteEngine On

<IfVersion < 2.4>
  ProxyPass /stomp/ ws://localhost:8889/stomp/
</IfVersion>
<IfVersion >= 2.4>
  RewriteCond %{REQUEST_URI} ^/stomp/
  RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
#  RewriteCond %{HTTP:CONNECTION} ^Upgrade$ [NC] # firefox send a Connection : keepalive,upgrade and not just Connection:upgrade
  RewriteRule /stomp/ ws://127.0.0.1:8889/stomp/ [P]
</IfVersion>

  RewriteCond %{REQUEST_URI} ^/ui.*
  RewriteCond %{REQUEST_URI} !^/ui/static.*
  RewriteRule "^/ui(/?.*)$" "http://127.0.0.1:8888/ui$1" [L,P]
  RedirectMatch ^/$ /ui/home/
  ProxyPassReverse /ui http://127.0.0.1:8888/ui

  RewriteCond %{REQUEST_URI} ^/o/.*
  RewriteRule "^/o(/?.*)$" "http://127.0.0.1:8888/o$1" [L,P]
  ProxyPassReverse /o http://127.0.0.1:8888/o

  RewriteCond %{REQUEST_URI} ^/api/external-links/?.*
  RewriteRule "^/api/external-links(/?.*)$" "http://127.0.0.1:8888/api/external-links$1" [L,P]
  ProxyPassReverse /api/external-links http://127.0.0.1:8888/api/external-link

  RewriteCond %{REQUEST_URI} ^/api/backup/?.*
  RewriteRule "^/api/backup(/?.*)$" "http://127.0.0.1:8888/api/backup$1" [L,P]
  ProxyPassReverse /api/backup http://127.0.0.1:8888/api/backup

  RewriteCond %{REQUEST_URI} ^/api/restore/?.*
  RewriteRule "^/api/restore(/?.*)$" "http://127.0.0.1:8888/api/restore$1" [L,P]
  ProxyPassReverse /api/restore http://127.0.0.1:8888/api/restore

    <Directory /ui>
        Options Indexes FollowSymLinks
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>

   <Location /ui/static>
        SetHandler none
   </Location>

    Alias /ui/static /opt/ericsson/unified-ui/lib/python3.7/site-packages/envivio/unified/static/

    <Directory /opt/ericsson/unified-ui/lib/python3.7/site-packages/envivio/unified/static/>
        # directives to effect the static directory
        Options -Indexes
        <IfVersion < 2.4>
            Allow from all
        </IfVersion>
        <IfVersion >= 2.4>
            Require all granted
        </IfVersion>
    </Directory>
