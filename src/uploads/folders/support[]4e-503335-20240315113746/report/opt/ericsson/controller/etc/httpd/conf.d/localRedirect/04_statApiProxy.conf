# Statistics service

# Set the LOCAL_SERVER_ID Apache environment variable
SetEnvIf %{QUERY_STRING} ^ LOCAL_SERVER_ID=standalone

# Local server request case
RewriteCond %{QUERY_STRING} ^.*?serverId=(.*?)(?:&.*)?$
RewriteCond %1::%{ENV:LOCAL_SERVER_ID} ^(.*?)::\1$
RewriteRule "^/api/statistics(.*)$" http://127.0.0.1:8000/api/statistics$1?%{QUERY_STRING} [L,P]

# Remote server request case
RewriteMap servermap txt:/opt/ericsson/controller/etc/serverid_mapping.cfg
RewriteCond %{QUERY_STRING} ^.*?serverId=(.*?)(?:&.*)?$
RewriteCond %1::%{ENV:LOCAL_SERVER_ID} !^(.*?)::\1$
RewriteCond ${servermap:%1} !^$
RewriteRule "^/api/statistics(.*)$" http://${servermap:%1}/api/statistics$1?%{QUERY_STRING} [L,P]
